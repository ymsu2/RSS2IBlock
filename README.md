RSS2IBlock
==========
Этот агент считывает сообщения из RSS канала и записывает в инфоблок. Можно указать как несколько каналов, так и разные инфоблоки.

Установка
---------

1. Поместите содержимое папки src (файл, где определен class RssToIBlock) в bitrix/php_interface/include/rss/

2. Создайте инфоблок со следующими свойствами типа строка: FEED_URL, LINK, ENC_URL, ENC_WIDTH, ENC_HEIGHT, CATEGORY
	FEED_URL -  адрес источника новостей
	LINK - адрес страницы с новостями
	ENC_URL - адрес картинки с новостями
	ENC_WIDTH, ENC_HEIGHT - ширина и высота картиеки
	CATEGORY - название категории новостей

3. Миграцию инфоблока на сайт можно осуществить с помощью бесплатного модуля "sprint.migration" (http://marketplace.1c-bitrix.ru/solutions/sprint.migration/)
структура инфоблока для миграции находяться в файле \php_interface\migrations\Version120220118162337.php

4. Шаблон для вывода новостей из инфоблока содержится в папке components\news.list\rss\

Примечание
-------------
Демо-пример страницы вывода новостей за последние 2 часа содержится в папке rss-news\index.php
Дата создания новости в БД хранится с учетом часового пояса первоисточника (UTC +3:00) "Europe/Moscow"
Локальное время сервера Битрикс по умолчанию находится в часовом поясе (UTC 0:00)
в фильтре это надо учитывать
$disp = 1; // берем новости за последние 2 часа (от UTC +3:00 отнимаем 2 часа, в итоге получаем смешение + 1 час от UTC 0:00)
$now  = date('d.m.Y H:i:s', time() + 3600 * $disp); // расчет производится от локального времени на сервере
$arFilter = array(">DATE_CREATE" => $now); // фильтр выбирает новости из ИБ, созданные за последние 2 часа. 

Пример использования
-------------

    function updateRSS()
    {               
	require_once($_SERVER["DOCUMENT_ROOT"].'/bitrix/php_interface/include/rss/RssToIBlock.php');

	$rssToIBlock = new RssToIBlock('ria.ru', 80, "/export/rss2/archive/index.xml", "", 19, 4); // 

	$rssToIBlock->fetch();
                
        return "updateRSS();";
    }

Конструктор RssToIBlock принимает параметры:
URL - url или доменное имя ресурса, с которого забираем RSS, в примере = 'ria.ru'
PORT - номер порта, в примере = 80
PATH - путь к скрипту, генерирующему RSS на сайте-сервере, в примере =  "/export/rss2/archive/index.xml"
QUERY_STR - Строка запроса, если она необходима. Например, ID=3&LANG=ru&TYPE=news&LIMIT=5. Обратите внимание, что строка запроса должна строиться на основании спецификации HTTP.
IBLOCK_ID - ID инфоблока в который будут записаны сообщения из RSS, в примере = 19
TM_LIMIT - лимит времени в часах, который прошел от времени создания новости, если лимит превышен, данные к себе не скачиваем, в примере берем новости за последние 4 часа (pubDate) от текущего времени.
-----------
